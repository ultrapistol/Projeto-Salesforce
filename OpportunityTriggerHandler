public class OpportunityTriggerHandler {
    
    public static void afterUpdate(List<Opportunity> newList, Map<Id, Opportunity> oldMap){
        List<Opportunity> closedWonOpps = new List <Opportunity>();
        
        for(Opportunity opp : newList){
            Opportunity oldOpp = oldMap.get(opp.Id);
            
            if (opp.StageName == 'Closed Won' && oldOpp.StageName != 'Closed Won'){
                ClosedWonOpps.add(opp);
            }
            
        }
        if (!closedWonOpps.isEmpty()) {
            System.debug('Oportunidades fechadas: ' + closedWonOpps.size());
            ContractService.createContracts(closedWonOpps);
            TaskService.createWelcomeTasks(closedWonOpps);
            GamificationService.addPointsForClosedWon(closedWonOpps);
        }
    }
}
